!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-dataflow"),require("vega-expression"),require("d3-color"),require("d3-array"),require("d3-format"),require("d3-time-format"),require("vega-scale"),require("vega-scenegraph"),require("vega-event-selector")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-dataflow","vega-expression","d3-color","d3-array","d3-format","d3-time-format","vega-scale","vega-scenegraph","vega-event-selector"],t):t(e.vega=e.vega||{},e.vega,e.vega,e.vega,e.d3,e.d3,e.d3,e.d3,e.vega,e.vega,e.vega)}(this,function(e,t,n,r,i,a,o,l,u,s,d){"use strict";function f(e,n){t.error(e+' for "outer" push: '+t.stringValue(n))}function c(e,t,n){var r=e+":"+n,i=bt[r];return i&&i[0]===t||(bt[r]=i=[t,t(n)]),i[1]}function p(e,t){return c("timeFormat",l.timeFormat,t)(e)}function g(e,t,n){return xt.setMonth(e),xt.setDate(t),p(xt,n)}function h(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function m(e,n){var r;return t.isFunction(e)?e:t.isString(e)?(r=n.scales[e])&&r.value:void 0}function v(e,t,n){var r=Pt+n;if(!t.hasOwnProperty(r))try{t[r]=e.scaleRef(n)}catch(e){}}function y(e,t,n,r){if(t[0].type===St)v(n,r,t[0].value);else if(t[0].type===Rt)for(e in n.scales)v(n,r,e)}function b(e){return function(t){return e*Math.exp(t)}}function x(e){return function(t){return Math.log(e*t)}}function k(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function S(e,n,r,i){var a=r(e[0]),o=r(t.peek(e)),l=(o-a)*n;return[i(a-l),i(o-l)]}function R(e,n,r,i,a){var o=i(n),l=i(e[0]),u=i(t.peek(e));return[a(o+(l-o)*r),a(o+(u-o)*r)]}function w(e){return function(t,n,r){var i=m(t,(r||this).context);return i&&i.path[e](n)}}function P(e){var t=this.context.data[e];return t?t.values.value:[]}function z(e,n,r,i){n[0].type!==St&&t.error("First argument to data functions must be a string literal.");var a=n[0].value,o=zt+a;i.hasOwnProperty(o)||(i[o]=r.getData(a).tuplesRef())}function O(e){return e.data}function j(e,t){var n=P.call(t,e);return n.root&&n.root.lookup||$t}function D(e,n){return e===n||e!==e&&n!==n||!(!t.isArray(e)||!t.isArray(n)||e.length!==n.length)&&$(e,n)}function $(e,t){for(var n=0,r=e.length;n<r;++n)if(!D(e[n],t[n]))return!1;return!0}function E(e){return function(t){for(var n in e)if(!D(t[n],e[n]))return!1;return!0}}function _(e,n){for(var r,i=n.fields,a=n.values,o=n.getter||(n.getter=[]),l=i.length,u=0;u<l;++u)if(o[u]=o[u]||t.field(i[u]),r=o[u](e),t.isDate(r)&&(r=t.toNumber(r)),t.isDate(a[u])&&(a[u]=t.toNumber(a[u])),n[_t+i[u]]){if(t.isDate(a[u][0])&&(a[u]=a[u].map(t.toNumber)),!Et(r,a[u],!0,!1))return!1}else if(r!==a[u])return!1;return!0}function V(e,n){for(var r,i,a,o=n.intervals,l=o.length,u=0;u<l;++u){if(i=o[u].extent,r=o[u].getter||(o[u].getter=t.field(o[u].field)),a=r(e),!i||i[0]===i[1])return!1;if(t.isDate(a)&&(a=t.toNumber(a)),t.isDate(i[0])&&(i=o[u].extent=i.map(t.toNumber)),t.isNumber(i[0])&&!Et(a,i))return!1;if(t.isString(i[0])&&i.indexOf(a)<0)return!1}return!0}function M(e,t,n,r){for(var i,a,o,l,u,s=this.context.data[e],d=s?s.values.value:[],f=s?s[At]&&s[At].value:void 0,c=n===Vt,p=d.length,g=0;g<p;++g)if(i=d[g],f&&c){if(a=a||{},-1===(o=a[l=i.unit]||0))continue;if(u=r(t,i),a[l]=u?-1:++o,u&&1===f.size)return!0;if(!u&&o===f.get(l).count)return!1}else if(u=r(t,i),c^u)return u;return p&&c}function A(e,t,n){return M.call(this,e,t,n,_)}function F(e,n,r,i){n[0].type!==St&&t.error("First argument to indata must be a string literal.");var a=n[0].value,o=n.length>=2&&n[n.length-1].value,l=wt+"unit";o!==Vt||i.hasOwnProperty(l)||(i[l]=r.getData(a).indataRef(r,"unit")),z(e,n,r,i)}function W(e,t,n,r){var i,a,o,l,u,s=this.context.data[e],d=s?s.values.value:[],f=s?s[At]&&s[At].value:void 0,c=d[0],p=0;if(c){for(i=t?c.encodings.length:c.fields.length;p<i;++p)if(t&&c.encodings[p]===t||n&&c.fields[p]===n){a=p,l=c[_t+c.fields[p]];break}return f&&1===f.size&&(r=Mt),f&&r===Vt?(u=d.reduce(function(e,t){return(e[t.unit]||(e[t.unit]=[])).push({unit:t.unit,value:t.values[a]}),e},{}),o=Object.keys(u).map(function(e){return{unit:e,value:l?L(u[e],Mt):C(u[e],Mt)}})):o=d.map(function(e){return{unit:e.unit,value:e.values[a]}}),l?L(o,r):C(o,r)}}function C(e,t){for(var n,r,i,a,o={},l=0,u={},s=[],d=0,f=e.length;d<f;++d)r=(n=e[d]).unit,a=n.value,o[r]||(o[r]=++l),(i=u[a])||(u[a]=i={value:a,units:{},count:0}),i.units[r]||(i.units[r]=++i.count);for(a in u)i=u[a],t===Vt&&i.count!==l||s.push(i.value);return s.length?s:void 0}function L(e,n){for(var r,i,a,o,l=n===Vt?N:q,u=0,s=e.length;u<s;++u)r=e[u].value,t.isDate(r[0])&&(r=r.map(t.toNumber)),(a=r[0])>(o=r[1])&&(o=r[0],a=r[1]),i=i?l(i,a,o):[a,o];return i&&i.length&&+i[0]!=+i[1]?i:void 0}function q(e,t,n){return e[0]>t&&(e[0]=t),e[1]<n&&(e[1]=n),e}function N(e,t,n){return n<e[0]||e[1]<t?[]:(e[0]<t&&(e[0]=t),e[1]>n&&(e[1]=n),e)}function B(e,t,n){return 1===arguments.length?Ft[e]:(Ft[e]=t,n&&(qt[e]=n),Bt&&(Bt.functions[e]=Lt+e),this)}function U(e){return e===It?Tt:e||Tt}function T(e,n){return(e.merge?I:e.stream?X:e.type?H:t.error("Invalid stream specification: "+t.stringValue(e)))(e,n)}function I(e,t){var n=Y({merge:e.merge.map(function(e){return T(e,t)})},e,t);return t.addStream(n).id}function X(e,t){var n=Y({stream:T(e.stream,t)},e,t);return t.addStream(n).id}function H(e,t){var n=t.event(U(e.source),e.type),r=Y({stream:n},e,t);return 1===Object.keys(r).length?n:t.addStream(r).id}function Y(e,n,r){var i=n.between;return i&&(2!==i.length&&t.error('Stream "between" parameter must have 2 entries: '+t.stringValue(n)),e.between=[T(i[0],r),T(i[1],r)]),i=n.filter?t.array(n.filter):[],(n.marktype||n.markname||n.markrole)&&i.push(G(n.marktype,n.markname,n.markrole)),n.source===It&&i.push("inScope(event.item)"),i.length&&(e.filter=Ut("("+i.join(")&&(")+")").$expr),null!=(i=n.throttle)&&(e.throttle=+i),null!=(i=n.debounce)&&(e.debounce=+i),n.consume&&(e.consume=!0),e}function G(e,t,n){var r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}function J(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function K(e,t,n,r){return new J(e,t,n,r)}function Q(e,t){return K("operator",e,t)}function Z(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function ee(e,t){return t?{$field:e,$name:t}:{$field:e}}function te(e,t){return{$compare:e,$order:t}}function ne(e){return{$key:e}}function re(e){return t.isObject(e)?(e.order===Qt?"-":"+")+ie(e.op,e.field):""}function ie(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}function ae(e){return e&&e.signal}function oe(e,t){return null!=e?e:t}function le(e){return function(t,n,r){return K(e,n,t||void 0,r)}}function ue(e){return Dn.hasOwnProperty(e)}function se(e){return"quantile"===e}function de(e,n){var r=e.type||"linear";jn.hasOwnProperty(r)||t.error("Unrecognized scale type: "+t.stringValue(r)),n.addScale(e.name,{type:r,domain:void 0})}function fe(e,t){var n,r=t.getScale(e.name).params;r.domain=he(e.domain,e,t),null!=e.range&&(r.range=ze(e,t,r)),null!=e.interpolate&&Pe(e.interpolate,r),null!=e.nice&&we(e.nice,r);for(n in e)r.hasOwnProperty(n)||"name"===n||(r[n]=ce(e[n],t))}function ce(e,n){return t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported object: "+t.stringValue(e)):e}function pe(e,t){return e.signal?t.signalRef(e.signal):e.map(function(e){return ce(e,t)})}function ge(e){t.error("Can not find data set: "+t.stringValue(e))}function he(e,n,r){if(e)return e.signal?r.signalRef(e.signal):(t.isArray(e)?me:e.fields?ye:ve)(e,n,r);null==n.domainMin&&null==n.domainMax||t.error("No scale domain defined for domainMin/domainMax to override.")}function me(e,t,n){return e.map(function(e){return ce(e,n)})}function ve(e,t,n){var r=n.getData(e.data);return r||ge(e.data),ue(t.type)?r.valuesRef(n,e.field,ke(e.sort,!1)):se(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function ye(e,n,r){var i=e.data,a=e.fields.reduce(function(e,n){return n=t.isString(n)?{data:i,field:n}:t.isArray(n)||n.signal?be(n,r):n,e.push(n),e},[]);return(ue(n.type)?xe:se(n.type)?Se:Re)(e,r,a)}function be(e,n){var r="_:vega:_"+zn++,i=nn({});return t.isArray(e)?i.value={$ingest:e}:e.signal&&n.signalRef("setdata("+t.stringValue(r)+","+e.signal+")"),n.addDataPipeline(r,[i,Sn({})]),{data:r,field:"data"}}function xe(e,t,n){var r,i,a,o;return r=n.map(function(e){var n=t.getData(e.data);return n||ge(e.data),n.countsRef(t,e.field)}),i=t.add(Zt({groupby:Kt,ops:["sum"],fields:[t.fieldRef("count")],as:["count"],pulse:r})),a=t.add(nn({pulse:Z(i)})),o=t.add(Pn({field:Kt,sort:t.sortRef(ke(e.sort,!0)),pulse:Z(a)})),Z(o)}function ke(e,n){return e&&(e.field||e.op?e.field||"count"===e.op?n&&e.field?t.error("Multiple domain scales can not sort by field."):n&&e.op&&"count"!==e.op&&t.error("Multiple domain scales support op count only."):t.error("No field provided for sort aggregate op: "+e.op):t.isObject(e)?e.field="key":e={field:"key"}),e}function Se(e,t,n){var r=n.map(function(e){var n=t.getData(e.data);return n||ge(e.data),n.domainRef(t,e.field)});return Z(t.add(pn({values:r})))}function Re(e,t,n){var r=n.map(function(e){var n=t.getData(e.data);return n||ge(e.data),n.extentRef(t,e.field)});return Z(t.add(cn({extents:r})))}function we(e,n){n.nice=t.isObject(e)?{interval:ce(e.interval),step:ce(e.step)}:ce(e)}function Pe(e,t){t.interpolate=ce(e.type||e),null!=e.gamma&&(t.interpolateGamma=ce(e.gamma))}function ze(e,n,r){var i=e.range,a=n.config.range;if(i.signal)return n.signalRef(i.signal);if(t.isString(i)){if(a&&a.hasOwnProperty(i))return e=t.extend({},e,{range:a[i]}),ze(e,n,r);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=ue(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t.error("Unrecognized scale range value: "+t.stringValue(i))}else{if(i.scheme)return r.scheme=ce(i.scheme,n),i.extent&&(r.schemeExtent=pe(i.extent,n)),void(i.count&&(r.schemeCount=ce(i.count,n)));if(i.step)return void(r.rangeStep=ce(i.step,n));if(ue(e.type)&&!t.isArray(i))return he(i,e,n);t.isArray(i)||t.error("Unsupported range type: "+t.stringValue(i))}return i.map(function(e){return ce(e,n)})}function Oe(e,n){return t.isArray(e)?e.map(function(e){return Oe(e,n)}):t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported parameter object: "+t.stringValue(e)):e}function je(e,n,r,i){var a,o,l;if(e.signal)a="datum",l=Un(e.signal,n,r,i);else if(e.group||e.parent){for(o=Math.max(1,e.level||1),a="item";o-- >0;)a+=".mark.group";e.parent?(l=e.parent,a+=".datum"):l=e.group}else e.datum?(a="datum",l=e.datum):t.error("Invalid field reference: "+t.stringValue(e));return e.signal||(t.isString(l)?(i[l]=1,l=t.splitAccessPath(l).map(t.stringValue).join("][")):l=je(l,n,r,i)),a+"["+l+"]"}function De(e,n){if(!t.isString(e))return-1;var r=n.scaleType(e);return"band"===r||"point"===r?1:0}function $e(e,n,r,i){var a;if(t.isString(e))a=Pt+e,r.hasOwnProperty(a)||(r[a]=n.scaleRef(e)),a=t.stringValue(a);else{for(a in n.scales)r[Pt+a]=n.scaleRef(a);a=t.stringValue(Pt)+"+"+(e.signal?"("+Un(e.signal,n,r,i)+")":Tn(e,n,r,i))}return"_["+a+"]"}function Ee(e,n,r,i){var a,o,l,u={},s="var o=item,datum=o.datum,$;";for(a in e)o=e[a],t.isArray(o)?s+=Jn(a,o,i,r,u):(l=Yn(a,o,i,r,u),s+=Gn("o",a,l));return s+=Nn(e,n),s+="return 1;",{$expr:s,$fields:Object.keys(u),$output:Object.keys(e)}}function _e(e){return t.isObject(e)?e:{value:e}}function Ve(e,t,n){return null!=n?(e[t]={value:n},1):0}function Me(e,n,r){for(var i in n)r&&r.hasOwnProperty(i)||(e[i]=t.extend(e[i]||{},n[i]));return e}function Ae(e,t,n,r,i,a){var o,l;(a=a||{}).encoders={$encode:o={}},e=Fe(e,t,n,r,i.config);for(l in e)o[l]=Ee(e[l],t,a,i);return a}function Fe(e,n,r,i,a){var o,l,u={};"legend"!=r&&0!==String(r).indexOf("axis")||(r=null),l=r===Qn?a.group:r===Kn?t.extend({},a.mark,a[n]):null;for(o in l)We(o,e)||("fill"===o||"stroke"===o)&&(We("fill",e)||We("stroke",e))||(u[o]={value:l[o]});return t.array(i).forEach(function(t){var n=a.style&&a.style[t];for(var r in n)We(r,e)||(u[r]={value:n[r]})}),e=t.extend({},e),e.enter=t.extend(u,e.enter),e}function We(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}function Ce(e,t,n){var r,i,a,o={};for(i=0,a=e.params.length;i<a;++i)o[(r=e.params[i]).name]=Le(r,t,n);return o}function Le(e,n,r){var i=e.type,a=n[e.name];if("index"===i)return Ne(e,n,r);{if(void 0!==a)return"param"===i?Be(e,n,r):"projection"===i?r.projectionRef(n[e.name]):e.array&&!ae(a)?a.map(function(t){return qe(e,t,r)}):qe(e,a,r);e.required&&t.error("Missing required "+t.stringValue(n.type)+" parameter: "+t.stringValue(e.name))}}function qe(e,n,r){var i=e.type;if(ae(n))return He(i)?t.error("Expression references can not be signals."):Ye(i)?r.fieldRef(n):Ge(i)?r.compareRef(n):r.signalRef(n.signal);var a=e.expr||Ye(i);return a&&Te(n)?Ut(n.expr,r):a&&Ie(n)?ee(n.field):He(i)?Ut(n,r):Xe(i)?Z(r.getData(n).values):Ye(i)?ee(n):Ge(i)?r.compareRef(n):n}function Ne(e,n,r){return t.isString(n.from)||t.error('Lookup "from" parameter must be a string literal.'),r.getData(n.from).lookupRef(r,n.key)}function Be(e,n,r){var i=n[e.name];return e.array?(t.isArray(i)||t.error("Expected an array of sub-parameters. Instead: "+t.stringValue(i)),i.map(function(t){return Ue(e,t,r)})):Ue(e,i,r)}function Ue(e,n,r){var i,a,o,l,u;for(l=0,u=e.params.length;l<u;++l){a=e.params[l];for(o in a.key)if(a.key[o]!==n[o]){a=null;break}if(a)break}return a||t.error("Unsupported parameter: "+t.stringValue(n)),i=t.extend(Ce(a,n,r),a.key),Z(r.add(hn(i)))}function Te(e){return e&&e.expr}function Ie(e){return e&&e.field}function Xe(e){return"data"===e}function He(e){return"expr"===e}function Ye(e){return"field"===e}function Ge(e){return"compare"===e}function Je(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function Ke(e){return t.isString(e)?e:null}function Qe(e,t,n){var r,i=ie(n.op,n.field);if(t.ops){for(var a=0,o=t.as.length;a<o;++a)if(t.as[a]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Ze(e,t,n,r,i,a,o){var l,u,s=t[n]||(t[n]={}),d=re(a),f=Ke(i);if(null!=f&&(e=t.scope,l=s[f+=d?"|"+d:""]),!l){var c=a?{field:Kt,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:Z(t.output)};d&&(c.sort=e.sortRef(a)),u=e.add(K(r,void 0,c)),o&&(t.index[i]=u),l=Z(u),null!=f&&(s[f]=l)}return l}function et(e,t,n){var r=nt(t,n[1].encode,"fontSize",An);if(e.size)return{$expr:"Math.max(Math.ceil(Math.sqrt(_.scale(datum))),"+r+")"};var i=nt(t,n[0].encode,"size");return Math.max(Math.ceil(Math.sqrt(i)),r)}function tt(e){var t={};return Ve(t,"fill",e.fillColor)+Ve(t,"stroke",e.strokeColor)+Ve(t,"strokeWidth",e.strokeWidth)+Ve(t,"strokeDash",e.strokeDash)+Ve(t,"cornerRadius",e.cornerRadius)?t:void 0}function nt(e,t,n,r){var i=t&&(t.update&&t.update[n]||t.enter&&t.enter[n]);return+(i?i.value:r&&(i=e.config.style[r])&&i[n])}function rt(e,n,r,i){var a,o,l,u,s,d,f=e.text,c=e.orient||n.orient,p=e.anchor||n.anchor,g=c===_n||c===En?-1:1,h=c===En||c===Vn,m={group:h?"width":"height"},v={};return v.enter=a={opacity:{value:0}},Ve(a,"fill",n.color),Ve(a,"font",n.font),Ve(a,"fontSize",n.fontSize),Ve(a,"fontWeight",n.fontWeight),v.exit={opacity:{value:0}},v.update=o={opacity:{value:1},text:t.isObject(f)?f:{value:f+""},offset:_e((null!=e.offset?e.offset:n.offset)||0)},"start"===p?(s=0,d="left"):"end"===p?(s=1,d="right"):(s=.5,d="center"),l={field:m,mult:s},u=g<0?{value:0}:h?{field:{group:"height"}}:{field:{group:"width"}},h?(o.x=l,o.y=u,o.angle={value:0},o.baseline={value:c===En?"bottom":"top"}):(o.x=u,o.y=l,o.angle={value:90*g},o.baseline={value:"bottom"}),o.align={value:d},o.limit={field:m},Ve(o,"angle",n.angle),Ve(o,"baseline",n.baseline),Ve(o,"limit",n.limit),er(nr,Zn,e.style||Fn,null,i,v,r)}function it(e,t){var n=[];e.transform&&e.transform.forEach(function(e){n.push(cr(e,t))}),e.on&&e.on.forEach(function(n){vr(n,t,e.name)}),t.addDataPipeline(e.name,at(e,t,n))}function at(e,n,r){var i,a,o,l,u,s=[],d=null,f=!1,c=!1;for(e.values?s.push(d=ot({$ingest:e.values,$format:e.format})):e.url?s.push(d=ot({$request:e.url,$format:e.format})):e.source&&(d=i=t.array(e.source).map(function(e){return Z(n.getData(e).output)}),s.push(null)),a=0,o=r.length;a<o;++a)u=(l=r[a]).metadata,d||u.source||s.push(d=ot()),s.push(l),u.generates&&(c=!0),u.modifies&&!c&&(f=!0),u.source?d=l:u.changes&&(d=null);return i&&(o=i.length-1,s[0]=bn({derive:f,pulse:o?i:i[0]}),(f||o)&&s.splice(1,0,ot())),d||s.push(ot()),s.push(Sn({})),s}function ot(e){var t=nn({},e);return t.metadata={source:!0},t}function lt(e,t){return{scale:e.scale,range:t}}function ut(e,n){var r,i,a,o,l,u=n.config;return n.background=e.background||u.background,n.eventConfig=u.events,l=Z(n.root=n.add(Q())),n.addSignal("width",e.width||-1),n.addSignal("height",e.height||-1),n.addSignal("padding",mt(e.padding,u)),n.addSignal("autosize",ht(e.autosize,u)),t.array(e.signals).forEach(function(e){Dr[e.name]||yt(e,n)}),i=n.add(nn()),a=Me({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),a=n.add(on(Ae(a,tr,Qn,e.style,n,{pulse:Z(i)}))),o=n.add(wn({layout:n.objectProperty(e.layout),legendMargin:u.legendMargin,autosize:n.signalRef("autosize"),mark:l,pulse:Z(a)})),n.operators.pop(),n.pushState(Z(a),Z(o),null),jr(e,n,!0),n.operators.push(o),r=n.add(tn({mark:l,pulse:Z(o)})),r=n.add(xn({pulse:Z(r)})),r=n.add(Sn({pulse:Z(r)})),n.addData("root",new Je(n,i,i,r)),n}function st(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.background=null,this.eventConfig=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function dt(e){this.config=e.config,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function ft(e){return(t.isArray(e)?ct:pt)(e)}function ct(e){for(var n,r="[",i=0,a=e.length;i<a;++i)n=e[i],r+=(i>0?",":"")+(t.isObject(n)?n.signal||ft(n):t.stringValue(n));return r+"]"}function pt(e){var n,r,i="{",a=0;for(n in e)r=e[n],i+=(++a>1?",":"")+t.stringValue(n)+":"+(t.isObject(r)?r.signal||ft(r):t.stringValue(r));return i+"}"}function gt(){return{padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:Ar},area:{fill:Ar},image:null,line:{stroke:Ar,strokeWidth:Mr},path:{stroke:Ar},rect:{fill:Ar},rule:{stroke:Fr},shape:{stroke:Ar},symbol:{fill:Ar,size:64},text:{fill:Fr,font:_r,fontSize:11},style:{"guide-label":{fill:Fr,font:_r,fontSize:10},"guide-title":{fill:Fr,font:_r,fontSize:11,fontWeight:"bold"},"group-title":{fill:Fr,font:_r,fontSize:13,fontWeight:"bold"},point:{size:Vr,strokeWidth:Mr,shape:"circle"},circle:{size:Vr,strokeWidth:Mr},square:{size:Vr,strokeWidth:Mr,shape:"square"},cell:{fill:"transparent",stroke:Cr}},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:Wr,grid:!1,gridWidth:1,gridColor:Cr,gridDash:[],gridOpacity:1,labels:!0,labelAngle:0,labelLimit:180,labelPadding:2,ticks:!0,tickColor:Wr,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titleAlign:"center",titlePadding:2},axisBand:{tickOffset:-1},legend:{orient:"right",offset:18,padding:0,entryPadding:5,titlePadding:5,gradientWidth:100,gradientHeight:20,gradientStrokeColor:Cr,gradientStrokeWidth:0,gradientLabelBaseline:"top",gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelOffset:8,labelLimit:160,symbolType:"circle",symbolSize:100,symbolFillColor:"transparent",symbolStrokeColor:Wr,symbolStrokeWidth:1.5,titleAlign:"left",titleBaseline:"top",titleLimit:180},title:{orient:"top",anchor:"middle",offset:2},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues",extent:[.2,1]},heatmap:{scheme:"viridis"},ramp:{scheme:"blues",extent:[.2,1]},diverging:{scheme:"blueorange"},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}var ht=function(e,n){return e=e||n.autosize,t.isObject(e)?e:(e=e||"pad",{type:e})},mt=function(e,n){return e=e||n.padding,t.isObject(e)?e:(e=+e||0,{top:e,bottom:e,left:e,right:e})},vt=["value","update","react","bind"],yt=function(e,t){var n=e.name;if("outer"===e.push)t.signals[n]||f("No prior signal definition",n),vt.forEach(function(t){void 0!==e[t]&&f("Invalid property ",t)});else{var r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}},bt={},xt=new Date(2e3,0,1),kt="undefined"!=typeof window&&window||null,St="Literal",Rt="Identifier",wt="@",Pt="%",zt=":",Ot=w("area"),jt=w("bounds"),Dt=w("centroid"),$t={},Et=function(e,t,n,r){var i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),n=void 0===n||n,r=void 0===r||r,(n?a<=e:a<e)&&(r?e<=o:e<o)},_t="bin_",Vt="intersect",Mt="union",At="index:unit",Ft={isArray:t.isArray,isBoolean:t.isBoolean,isDate:t.isDate,isNumber:t.isNumber,isObject:t.isObject,isRegExp:t.isRegExp,isString:t.isString,isTuple:n.isTuple,toBoolean:t.toBoolean,toDate:t.toDate,toNumber:t.toNumber,toString:t.toString,pad:t.pad,peek:t.peek,truncate:t.truncate,rgb:i.rgb,lab:i.lab,hcl:i.hcl,hsl:i.hsl,sequence:a.range,format:function(e,t){return c("format",o.format,t)(e)},utcFormat:function(e,t){return c("utcFormat",l.utcFormat,t)(e)},utcParse:function(e,t){return c("utcParse",l.utcParse,t)(e)},timeFormat:p,timeParse:function(e,t){return c("timeParse",l.timeParse,t)(e)},monthFormat:function(e){return g(e,1,"%B")},monthAbbrevFormat:function(e){return g(e,1,"%b")},dayFormat:function(e){return g(0,2+e,"%A")},dayAbbrevFormat:function(e){return g(0,2+e,"%a")},quarter:function(e){return 1+~~(new Date(e).getMonth()/3)},utcquarter:function(e){return 1+~~(new Date(e).getUTCMonth()/3)},warn:function(){return h(this.context.dataflow,"warn",arguments)},info:function(){return h(this.context.dataflow,"info",arguments)},debug:function(){return h(this.context.dataflow,"debug",arguments)},inScope:function(e){var t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},clampRange:function(e,t,n){var r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),(r=a-i)>=n-t?[t,n]:[Math.min(Math.max(i,t),n-r),Math.min(Math.max(a,r),n)]},pinchDistance:function(e){var t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){var t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){return kt?kt.screen:{}},containerSize:function(){var e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){return kt?[kt.innerWidth,kt.innerHeight]:[void 0,void 0]},span:function(e){return e[e.length-1]-e[0]||0},bandspace:function(e,t,n){return u.bandSpace(e||0,t||0,n||0)},inrange:Et,setdata:function(e,n){var r=this.context.dataflow,i=this.context.data[e].input;return r.pulse(i,r.changeset().remove(t.truthy).insert(n)),1},panLinear:function(e,n){return S(e,n,t.toNumber,t.identity)},panLog:function(e,t){var n=Math.sign(e[0]);return S(e,t,x(n),b(n))},panPow:function(e,t,n){return S(e,t,k(n),k(1/n))},zoomLinear:function(e,n,r){return R(e,n,r,t.toNumber,t.identity)},zoomLog:function(e,t,n){var r=Math.sign(e[0]);return R(e,t,n,x(r),b(r))},zoomPow:function(e,t,n,r){return R(e,t,n,k(r),k(1/r))},encode:function(e,t,n){if(e){var r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,r,i,a,o,l){var u,s,d=this.context.dataflow,f=this.context.data[e],c=f.input,p=f.changes,g=d.stamp();if(!1===d._trigger||!(c.value.length||r||a))return 0;if((!p||p.stamp<g)&&(f.changes=p=d.changeset(),p.stamp=g,d.runAfter(function(){f.modified=!0,d.pulse(c,p).run()},!0)),i&&(u=!0===i?t.truthy:t.isArray(i)||n.isTuple(i)?i:E(i),p.remove(u)),r&&p.insert(r),a&&(u=E(a),c.value.some(u)?p.remove(u):p.insert(a)),o)for(s in l)p.modify(o,s,l[s]);return 1}},Wt=["view","item","group","xy","x","y"],Ct="event.vega.",Lt="this.",qt={};B("bandwidth",function(e,t){var n=m(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},y),B("copy",function(e,t){var n=m(e,(t||this).context);return n?n.copy():void 0},y),B("domain",function(e,t){var n=m(e,(t||this).context);return n?n.domain():[]},y),B("range",function(e,t){var n=m(e,(t||this).context);return n&&n.range?n.range():[]},y),B("invert",function(e,n,r){var i=m(e,(r||this).context);return i?t.isArray(n)?(i.invertRange||i.invert)(n):(i.invert||i.invertExtent)(n):void 0},y),B("scale",function(e,t,n){var r=m(e,(n||this).context);return r?r(t):void 0},y),B("gradient",function(e,t,n,r){var i=s.Gradient(t,n),a=e.domain(),o=a[0],l=a[a.length-1],d=u.scaleFraction(e,o,l);e.ticks&&(o!==(a=e.ticks(+r||15))[0]&&a.unshift(o),l!==a[a.length-1]&&a.push(l));for(var f=0,c=a.length;f<c;++f)i.stop(d(a[f]),e(a[f]));return i},y),B("geoArea",Ot,y),B("geoBounds",jt,y),B("geoCentroid",Dt,y),B("indata",function(e,t,n){var r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i},function(e,n,r,i){n[0].type!==St&&t.error("First argument to indata must be a string literal."),n[1].type!==St&&t.error("Second argument to indata must be a string literal.");var a=n[0].value,o=n[1].value,l=wt+o;i.hasOwnProperty(l)||(i[l]=r.getData(a).indataRef(r,o))}),B("data",P,z),B("vlSingle",A,z),B("vlSingleDomain",W,z),B("vlMulti",A,F),B("vlMultiDomain",W,F),B("vlInterval",function(e,t,n){return M.call(this,e,t,n,V)},z),B("vlIntervalDomain",function(e,t,n,r){var i,a,o,l,u,s=this.context.data[e],d=s?s.values.value:[],f=d[0],c=0;if(f){for(i=f.intervals.length;c<i;++c)if(a=f.intervals[c],t&&a.encoding===t||n&&a.field===n){if(!a.extent)return;o=c,u=a.extent.length>2;break}return l=d.reduce(function(e,t){var n=t.intervals[o].extent,r=u?n.map(function(e){return{unit:t.unit,value:e}}):{unit:t.unit,value:n};return u?e.push.apply(e,r):e.push(r),e},[]),u?C(l,r):L(l,r)}},z),B("treePath",function(e,t,n){var r=j(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(O):void 0},z),B("treeAncestors",function(e,t){var n=j(e,this)[t];return n?n.ancestors().map(O):void 0},z);var Nt={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_["+t.stringValue("$"+e)+"]"},functions:function(e){var t=r.functions(e);Wt.forEach(function(e){t[e]=Ct+e});for(var n in Ft)t[n]=Lt+n;return t},constants:r.constants,visitors:qt},Bt=r.codegen(Nt),Ut=function(e,n,i){var a,o,l={};try{a=r.parse(e)}catch(n){t.error("Expression parse error: "+t.stringValue(e))}return a.visit(function(e){if("CallExpression"===e.type){var t=e.callee.name,r=Nt.visitors[t];r&&r(t,e.arguments,n,l)}}),(o=Bt(a)).globals.forEach(function(e){var t="$"+e;!l.hasOwnProperty(t)&&n.getSignal(e)&&(l[t]=n.signalRef(e))}),{$expr:i?i+"return("+o.code+");":o.code,$fields:o.fields,$params:l}},Tt="view",It="scope",Xt=function(e,t){return e.signal?t.getSignal(e.signal).id:e.scale?t.getScale(e.scale).id:T(e,t)},Ht="var datum=event.item&&event.item.datum;",Yt=function(e,n,r){var i,a=e.events,o=e.update,l=e.encode,u=[],s="";a||t.error("Signal update missing events specification."),t.isString(a)&&(a=d.selector(a)),(a=t.array(a).filter(function(e){return e.signal||e.scale?(u.push(e),0):1})).length&&u.push(a.length>1?{merge:a}:a[0]),null!=l&&(o&&t.error("Signal encode and update are mutually exclusive."),o="encode(item(),"+t.stringValue(l)+")"),s=t.isString(o)?Ut(o,n,Ht):null!=o.expr?Ut(o.expr,n,Ht):null!=o.value?o.value:null!=o.signal?{$expr:"_.value",$params:{value:n.signalRef(o.signal)}}:t.error("Invalid signal update specification."),i={target:r,update:s},e.force&&(i.options={force:!0}),u.forEach(function(e){e={source:Xt(e,n)},n.addUpdate(t.extend(e,i))})},Gt=function(e,t){var n=t.getSignal(e.name);if(e.update){var r=Ut(e.update,t);n.update=r.$expr,n.params=r.$params}e.on&&e.on.forEach(function(e){Yt(e,t,n.id)})},Jt={$tupleid:1,toString:function(){return":_tupleid_:"}},Kt=ee("key"),Qt="descending",Zt=le("aggregate"),en=le("axisticks"),tn=le("bound"),nn=le("collect"),rn=le("compare"),an=le("datajoin"),on=le("encode"),ln=le("facet"),un=le("field"),sn=le("key"),dn=le("legendentries"),fn=le("mark"),cn=le("multiextent"),pn=le("multivalues"),gn=le("overlap"),hn=le("params"),mn=le("prefacet"),vn=le("projection"),yn=le("proxy"),bn=le("relay"),xn=le("render"),kn=le("scale"),Sn=le("sieve"),Rn=le("sortitems"),wn=le("viewlayout"),Pn=le("values"),zn=0,On=["identity","ordinal","band","point","bin-linear","bin-ordinal","linear","pow","sqrt","log","sequential","time","utc","quantize","quantile","threshold"],jn=t.toSet(On),Dn=t.toSet(On.slice(1,6)),$n=function(e,t){var n={};for(var r in e)"name"!==r&&(n[r]=Oe(e[r],t));t.addProjection(e.name,n)},En="top",_n="left",Vn="bottom",Mn="value",An="guide-label",Fn="group-title",Wn=["shape","size","fill","stroke","strokeDash","opacity"],Cn={name:1,interactive:1},Ln=t.toSet(["rule"]),qn=t.toSet(["group","image","rect"]),Nn=function(e,t){var n="";return Ln[t]?n:(e.x2&&(e.x?(qn[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(qn[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;"),n)},Bn=function(e,t,n,r){function i(e,i,a,o){return"this."+e+"("+[Yn(null,i,t,n,r),Yn(null,a,t,n,r),Yn(null,o,t,n,r)].join(",")+").toString()"}return e.c?i("hcl",e.h,e.c,e.l):e.h||e.s?i("hsl",e.h,e.s,e.l):e.l||e.a?i("lab",e.l,e.a,e.b):e.r||e.g||e.b?i("rgb",e.r,e.g,e.b):null},Un=function(e,n,r,i){var a=Ut(e,n);return a.$fields.forEach(function(e){i[e]=1}),t.extend(r,a.$params),a.$expr},Tn=function(e,n,r,i){return je(t.isObject(e)?e:{datum:e},n,r,i)},In=function(e,t,n,r,i){var a,o,l,u=$e(e.scale,n,r,i);return null!=e.range?(o=u+".range()",t=0===(a=+e.range)?o+"[0]":"($="+o+","+(1===a?"$[$.length-1]":"$[0]+"+a+"*($[$.length-1]-$[0])")+")"):(void 0!==t&&(t=u+"("+t+")"),e.band&&(l=De(e.scale,n))&&(a=(o=u+".bandwidth")+"()"+(1===(a=+e.band)?"":"*"+a),l<0&&(a="("+o+"?"+a+":0)"),t=(t?t+"+":"")+a,e.extra&&(t="(datum.extra?"+u+"(datum.extra.value):"+t+")")),null==t&&(t="0")),t},Xn=function(e,n,r,i){return"this.gradient("+$e(e.gradient,n,r,i)+","+t.stringValue(e.start)+","+t.stringValue(e.stop)+","+t.stringValue(e.count)+")"},Hn=function(e,n,r,i){return t.isObject(e)?"("+Yn(null,e,n,r,i)+")":e},Yn=function(e,n,r,i,a){if(null!=n.gradient)return Xn(n,r,i,a);var o=n.signal?Un(n.signal,r,i,a):n.color?Bn(n.color,r,i,a):null!=n.field?Tn(n.field,r,i,a):void 0!==n.value?t.stringValue(n.value):void 0;return null!=n.scale&&(o=In(n,o,r,i,a)),void 0===o&&(o=null),null!=n.exponent&&(o="Math.pow("+o+","+Hn(n.exponent,r,i,a)+")"),null!=n.mult&&(o+="*"+Hn(n.mult,r,i,a)),null!=n.offset&&(o+="+"+Hn(n.offset,r,i,a)),n.round&&(o="Math.round("+o+")"),o},Gn=function(e,n,r){return e+"["+t.stringValue(n)+"]="+r+";"},Jn=function(e,t,n,r,i){var a="";return t.forEach(function(t){var o=Yn(e,t,n,r,i);a+=t.test?Un(t.test,n,r,i)+"?"+o+":":o}),Gn("o",e,a)},Kn="mark",Qn="frame",Zn="title",er=function(e,t,n,r,i,a,o){return{type:e,name:o?o.name:void 0,role:t,style:o&&o.style||n,key:r,from:i,interactive:!(!o||!o.interactive),encode:Me(a,o,Cn)}},tr="group",nr="text",rr=function(e,t,n,r){var i,a,o={value:0},l={};return l.enter=i={opacity:o,x:o,y:o},Ve(i,"width",n.gradientWidth),Ve(i,"height",n.gradientHeight),Ve(i,"stroke",n.gradientStrokeColor),Ve(i,"strokeWidth",n.gradientStrokeWidth),l.exit={opacity:o},l.update=a={x:o,y:o,fill:{gradient:t},opacity:{value:1}},Ve(a,"width",n.gradientWidth),Ve(a,"height",n.gradientHeight),er("rect","legend-gradient",null,void 0,void 0,l,r)},ir=function(e,t,n,r){var i,a,o={value:0},l={};return l.enter=i={opacity:o,text:{field:"label"}},Ve(i,"fill",t.labelColor),Ve(i,"font",t.labelFont),Ve(i,"fontSize",t.labelFontSize),Ve(i,"baseline",t.gradientLabelBaseline),Ve(i,"limit",t.gradientLabelLimit),l.exit={opacity:o},l.update=a={opacity:{value:1}},i.x=a.x={field:"perc",mult:t.gradientWidth},i.y=a.y={value:t.gradientHeight,offset:t.gradientLabelOffset},i.align=a.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},er(nr,"legend-label",An,"perc",r,l,n)},ar=function(e,t,n,r){var i,a,o={value:0},l={};return l.enter=i={opacity:o},Ve(i,"align",t.labelAlign),Ve(i,"baseline",t.labelBaseline),Ve(i,"fill",t.labelColor),Ve(i,"font",t.labelFont),Ve(i,"fontSize",t.labelFontSize),Ve(i,"limit",t.labelLimit),l.exit={opacity:o},l.update=a={opacity:{value:1},text:{field:"label"}},i.x=a.x={field:"offset",offset:t.labelOffset},i.y=a.y={field:"size",mult:.5,offset:{field:"total",offset:{field:{group:"entryPadding"},mult:{field:"index"}}}},er(nr,"legend-label",An,Mn,r,l,n)},or=function(e,t,n,r){var i,a,o={value:0},l={};return l.enter=i={opacity:o},Ve(i,"shape",t.symbolType),Ve(i,"size",t.symbolSize),Ve(i,"strokeWidth",t.symbolStrokeWidth),e.fill||(Ve(i,"fill",t.symbolFillColor),Ve(i,"stroke",t.symbolStrokeColor)),l.exit={opacity:o},l.update=a={opacity:{value:1}},i.x=a.x={field:"offset",mult:.5},i.y=a.y={field:"size",mult:.5,offset:{field:"total",offset:{field:{group:"entryPadding"},mult:{field:"index"}}}},Wn.forEach(function(t){e[t]&&(a[t]=i[t]={scale:e[t],field:Mn})}),er("symbol","legend-symbol",null,Mn,r,l,n)},lr=function(e,t,n,r){var i,a={value:0},o=e.title,l={};return l.enter=i={x:{field:{group:"padding"}},y:{field:{group:"padding"}},opacity:a},Ve(i,"align",t.titleAlign),Ve(i,"baseline",t.titleBaseline),Ve(i,"fill",t.titleColor),Ve(i,"font",t.titleFont),Ve(i,"fontSize",t.titleFontSize),Ve(i,"fontWeight",t.titleFontWeight),Ve(i,"limit",t.titleLimit),l.exit={opacity:a},l.update={opacity:{value:1},text:o&&o.signal?{signal:o.signal}:{value:o+""}},er(nr,"legend-title","guide-title",null,r,l,n)},ur=function(e,t,n,r,i,a,o){return{type:tr,name:n,role:e,style:t,from:r,interactive:i,encode:a,marks:o}},sr=function(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")?e.type===tr?"scope":t||Kn:t},dr=function(e){return{clip:e.clip||!1,interactive:!1!==e.interactive,marktype:e.type,name:e.name||void 0,role:e.role||sr(e),zindex:+e.zindex||void 0}},fr=function(e){return e},cr=function(e,r){var i=n.definition(e.type);i||t.error("Unrecognized transform type: "+t.stringValue(e.type));var a=K(i.type.toLowerCase(),null,Ce(i,e,r));return e.signal&&r.addSignal(e.signal,r.proxy(a)),a.metadata=i.metadata||{},a},pr=function(e,n,r){var i,a,o,l,u;return e?(i=e.facet)&&(n||t.error("Only group marks can be faceted."),null!=i.field?l=u=Z(r.getData(i.data).output):(a=r.keyRef(i.groupby),e.data?u=Z(r.getData(e.data).aggregate):((o=cr(t.extend({type:"aggregate",groupby:t.array(i.groupby)},i.aggregate))).params.key=a,o.params.pulse=Z(r.getData(i.data).output),l=u=Z(r.add(o))))):l=Z(r.add(nn(null,[{}]))),l||(l=e.$ref?e:Z(e.mark?r.getData(fr(e.mark)).output:r.getData(e.data).output)),{key:a,pulse:l,parent:u}};Je.fromEntries=function(e,t){var n=t.length,r=1,i=t[0],a=t[n-1],o=t[n-2],l=null;for(e.add(t[0]);r<n;++r)t[r].params.pulse=Z(t[r-1]),e.add(t[r]),"aggregate"===t[r].type&&(l=t[r]);return new Je(e,i,o,a,l)};var gr=Je.prototype;gr.countsRef=function(e,t,n){var r,i,a,o=this,l=o.counts||(o.counts={}),u=Ke(t);return null!=u&&(e=o.scope,r=l[u]),r?n&&n.field&&Qe(e,r.agg.params,n):(a={groupby:e.fieldRef(t,"key"),pulse:Z(o.output)},n&&n.field&&Qe(e,a,n),r={agg:i=e.add(Zt(a)),ref:Z(r=e.add(nn({pulse:Z(i)})))},null!=u&&(l[u]=r)),r.ref},gr.tuplesRef=function(){return Z(this.values)},gr.extentRef=function(e,t){return Ze(e,this,"extent","extent",t,!1)},gr.domainRef=function(e,t){return Ze(e,this,"domain","values",t,!1)},gr.valuesRef=function(e,t,n){return Ze(e,this,"vals","values",t,n||!0)},gr.lookupRef=function(e,t){return Ze(e,this,"lookup","tupleindex",t,!1)},gr.indataRef=function(e,t){return Ze(e,this,"indata","tupleindex",t,!0,!0)};var hr=function(e,n,r){var i,a,o,l,u=e.from.facet,s=u.name,d=Z(n.getData(u.data).output);u.name||t.error("Facet must have a name: "+t.stringValue(u)),u.data||t.error("Facet must reference a data set: "+t.stringValue(u)),u.field?l=n.add(mn({field:n.fieldRef(u.field),pulse:d})):u.groupby?l=n.add(ln({key:n.keyRef(u.groupby),group:Z(n.proxy(r.parent)),pulse:d})):t.error("Facet must specify groupby or field: "+t.stringValue(u)),a=(i=n.fork()).add(nn()),o=i.add(Sn({pulse:Z(a)})),i.addData(s,new Je(i,a,a,o)),i.addSignal("parent",null),l.params.subflow={$subflow:jr(e,i).toRuntime()}},mr=function(e,t,n){var r=t.add(mn({pulse:n.pulse})),i=t.fork();i.add(Sn()),i.addSignal("parent",null),r.params.subflow={$subflow:jr(e,i).toRuntime()}},vr=function(e,t,n){var r,i,a=e.remove,o=e.insert,l=e.toggle,u=e.modify,s=e.values,d=t.add(Q());r="if("+e.trigger+',modify("'+n+'",'+[o,a,l,u,s].map(function(e){return null==e?"null":e}).join(",")+"),0)",i=Ut(r,t),d.update=i.$expr,d.params=i.$params},yr=function(e,n){var r,i,a,o,l,u,s,d,f,c,p,g,h,m=sr(e),v=e.type===tr,y=e.from&&e.from.facet,b=e.layout||"scope"===m||m===Qn,x=m===Kn||b||y;a=pr(e.from,v,n),f=Z(i=n.add(an({key:a.key||(e.key?ee(e.key):void 0),pulse:a.pulse,clean:!v}))),i=o=n.add(nn({pulse:f})),c=Z(i=n.add(fn({markdef:dr(e),context:{$context:!0},groups:n.lookup(),parent:n.signals.parent?n.signalRef("parent"):null,index:n.markpath(),pulse:Z(i)}))),(i=n.add(on(Ae(e.encode,e.type,m,e.style,n,{pulse:c})))).params.parent=n.encode(),e.transform&&e.transform.forEach(function(e){var r=cr(e,n);(r.metadata.generates||r.metadata.changes)&&t.error("Mark transforms should not generate new data."),r.params.pulse=Z(i),n.add(i=r)}),e.sort&&(i=n.add(Rn({sort:n.compareRef(e.sort),pulse:Z(i)}))),p=Z(i),(y||b)&&(g=Z(b=n.add(wn({layout:n.objectProperty(e.layout),legendMargin:n.config.legendMargin,mark:c,pulse:p})))),h=Z(l=n.add(tn({mark:c,pulse:g||p}))),v&&(x&&((r=n.operators).pop(),b&&r.pop()),n.pushState(p,g||h,f),y?hr(e,n,a):x?mr(e,n,a):jr(e,n),n.popState(),x&&(b&&r.push(b),r.push(l))),e.overlap&&(h=Z(n.add(gn({method:!0===e.overlap?"parity":e.overlap,pulse:h})))),u=n.add(xn({pulse:h})),s=n.add(Sn({pulse:Z(u)},void 0,n.parent())),null!=e.name&&(d=fr(e.name),n.addData(d,new Je(n,o,u,s)),e.on&&e.on.forEach(function(e){(e.insert||e.remove||e.toggle)&&t.error("Marks only support modify triggers."),vr(e,n,d)}))},br=function(e,n){var r,i,a,o,l,u,s,d,f=e.type||"symbol",c=n.config.legend,p=e.encode||{},g=p.legend||{},h=g.name||void 0,m=!!g.interactive,v=g.style,y=e.size||e.shape||e.fill||e.stroke||e.strokeDash||e.opacity;return y||t.error("Missing valid scale for legend."),r={orient:oe(e.orient,c.orient),title:null!=e.title},i=Z(n.add(nn(null,[r]))),g=Me({enter:tt(c),update:{offset:_e(oe(e.offset,c.offset)),padding:_e(oe(e.padding,c.padding)),titlePadding:_e(oe(e.titlePadding,c.titlePadding))}},g,Cn),u={update:{x:{field:{group:"padding"}},y:{field:{group:"padding"}},entryPadding:_e(oe(e.entryPadding,c.entryPadding))}},"gradient"===f?(a=Z(n.add(dn({type:"gradient",scale:n.scaleRef(y),count:n.objectProperty(e.tickCount),values:n.objectProperty(e.values),formatSpecifier:n.property(e.format)}))),d=[rr(0,y,c,p.gradient),ir(0,c,p.labels,a)]):(a=Z(n.add(dn(s={scale:n.scaleRef(y),count:n.objectProperty(e.tickCount),values:n.objectProperty(e.values),formatSpecifier:n.property(e.format)}))),d=[or(e,c,p.symbols,a),ar(0,c,p.labels,a)],s.size=et(e,n,d)),d=[ur("legend-entry",null,null,i,m,u,d)],r.title&&(l=lr(e,c,p.title,i),u.update.y.offset={field:{group:"titlePadding"},offset:nt(n,l.encode,"fontSize","guide-title")},d.push(l)),o=ur("legend",v,h,i,m,g,d),e.zindex&&(o.zindex=e.zindex),yr(o,n)},xr=function(e,n){e=t.isString(e)?{text:e}:e;var r,i,a,o=n.config.title,l=t.extend({},e.encode);return r={orient:null!=e.orient?e.orient:o.orient},i=Z(n.add(nn(null,[r]))),l.name=e.name,l.interactive=e.interactive,a=rt(e,o,l,i),e.zindex&&(a.zindex=e.zindex),yr(a,n)},kr=function(e,n){var r=n.config,i=e.orient,a=i===En||i===Vn?r.axisX:r.axisY,o=r["axis"+i[0].toUpperCase()+i.slice(1)],l="band"===n.scaleType(e.scale)&&r.axisBand;return a||o||l?t.extend({},r.axis,a,o,l):r.axis},Sr=function(e,t,n,r){var i,a,o,l,u,s=e.orient,d={value:0},f={};return f.enter=i={opacity:d},Ve(i,"stroke",t.domainColor),Ve(i,"strokeWidth",t.domainWidth),f.exit={opacity:d},f.update=a={opacity:{value:1}},s===En||s===Vn?(o="x",u="y"):(o="y",u="x"),l=o+"2",i[u]=d,a[o]=i[o]=lt(e,0),a[l]=i[l]=lt(e,1),er("rule","axis-domain",null,null,r,f,n)},Rr=function(e,t,n,r){var i,a,o,l,u,s,d,f,c=e.orient,p=e.gridScale,g=c===_n||c===En?1:-1,h=g*e.offset||0,m={value:0},v={};return v.enter=i={opacity:m},Ve(i,"stroke",t.gridColor),Ve(i,"strokeWidth",t.gridWidth),Ve(i,"strokeDash",t.gridDash),v.exit=a={opacity:m},v.update=o={},Ve(o,"opacity",t.gridOpacity),l={scale:e.scale,field:Mn,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra,offset:t.tickOffset},c===En||c===Vn?(u="x",s="y",f="height"):(u="y",s="x",f="width"),d=s+"2",o[u]=i[u]=a[u]=l,p?(i[s]={scale:p,range:0,mult:g,offset:h},o[d]=i[d]={scale:p,range:1,mult:g,offset:h}):(i[s]={value:h},o[d]=i[d]={signal:f,mult:g,offset:h}),er("rule","axis-grid",null,Mn,r,v,n)},wr=function(e,t,n,r,i){var a,o,l,u,s,d=e.orient,f=d===_n||d===En?-1:1,c={value:0},p={};return p.enter=a={opacity:c},Ve(a,"stroke",t.tickColor),Ve(a,"strokeWidth",t.tickWidth),p.exit=o={opacity:c},p.update=l={opacity:{value:1}},u=_e(i),u.mult=f,s={scale:e.scale,field:Mn,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra,offset:t.tickOffset},d===En||d===Vn?(l.y=a.y=c,l.y2=a.y2=u,l.x=a.x=o.x=s):(l.x=a.x=c,l.x2=a.x2=u,l.y=a.y=o.y=s),er("rule","axis-tick",null,Mn,r,p,n)},Pr=function(e,t,n,r,i){var a,o,l,u,s,d=e.orient,f=e.labelOverlap,c=d===_n||d===En?-1:1,p=null!=e.labelPadding?e.labelPadding:t.labelPadding,g={value:0},h={};return h.enter=a={opacity:g},Ve(a,"angle",t.labelAngle),Ve(a,"fill",t.labelColor),Ve(a,"font",t.labelFont),Ve(a,"fontSize",t.labelFontSize),Ve(a,"limit",t.labelLimit),h.exit=o={opacity:g},h.update=l={opacity:{value:1},text:{field:"label"}},u=_e(i),u.mult=c,u.offset=_e(p),u.offset.mult=c,s={scale:e.scale,field:Mn,band:.5,offset:t.tickOffset},d===En||d===Vn?(l.y=a.y=u,l.x=a.x=o.x=s,Ve(l,"align","center"),Ve(l,"baseline",d===En?"bottom":"top")):(l.x=a.x=u,l.y=a.y=o.y=s,Ve(l,"align","right"===d?"left":"right"),Ve(l,"baseline","middle")),e=er(nr,"axis-label",An,Mn,r,h,n),e.overlap=f||t.labelOverlap,e},zr=function(e,t,n,r){var i,a,o,l=e.orient,u=e.title,s=l===_n||l===En?-1:1,d=l===En||l===Vn,f={};return f.enter=i={opacity:{value:0}},Ve(i,"align",t.titleAlign),Ve(i,"fill",t.titleColor),Ve(i,"font",t.titleFont),Ve(i,"fontSize",t.titleFontSize),Ve(i,"fontWeight",t.titleFontWeight),Ve(i,"limit",t.titleLimit),f.exit={opacity:{value:0}},f.update=a={opacity:{value:1},text:u&&u.signal?{signal:u.signal}:{value:u+""}},o={scale:e.scale,range:.5},d?(a.x=o,a.angle={value:0},a.baseline={value:l===En?"bottom":"top"}):(a.y=o,a.angle={value:90*s},a.baseline={value:"bottom"}),Ve(a,"angle",t.titleAngle),Ve(a,"baseline",t.titleBaseline),!Ve(a,"x",t.titleX)&&d&&!We("x",n)&&(f.enter.auto={value:!0}),!Ve(a,"y",t.titleY)&&!d&&!We("y",n)&&(f.enter.auto={value:!0}),er(nr,"axis-title","guide-title",null,r,f,n)},Or=function(e,t){var n,r,i,a,o,l,u=kr(e,t),s=e.encode||{},d=s.axis||{},f=d.name||void 0,c=!!d.interactive,p=d.style;return n={orient:e.orient,ticks:!!oe(e.ticks,u.ticks),labels:!!oe(e.labels,u.labels),grid:!!oe(e.grid,u.grid),domain:!!oe(e.domain,u.domain),title:!!oe(e.title,!1)},r=Z(t.add(nn({},[n]))),d=Me({update:{range:{signal:'abs(span(range("'+e.scale+'")))'},offset:_e(oe(e.offset,0)),position:_e(oe(e.position,0)),titlePadding:_e(oe(e.titlePadding,u.titlePadding)),minExtent:_e(oe(e.minExtent,u.minExtent)),maxExtent:_e(oe(e.maxExtent,u.maxExtent))}},s.axis,Cn),i=Z(t.add(en({scale:t.scaleRef(e.scale),extra:u.tickExtra,count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),formatSpecifier:t.property(e.format)}))),l=[],n.grid&&l.push(Rr(e,u,s.grid,i)),n.ticks&&(a=oe(e.tickSize,u.tickSize),l.push(wr(e,u,s.ticks,i,a))),n.labels&&(a=n.ticks?a:0,l.push(Pr(e,u,s.labels,i,a))),n.domain&&l.push(Sr(e,u,s.domain,r)),n.title&&l.push(zr(e,u,s.title,r)),o=ur("axis",p,f,r,c,d,l),e.zindex&&(o.zindex=e.zindex),yr(o,t)},jr=function(e,n,r){var i=t.array(e.signals),a=t.array(e.scales);return r||i.forEach(function(e){yt(e,n)}),t.array(e.projections).forEach(function(e){$n(e,n)}),a.forEach(function(e){de(e,n)}),t.array(e.data).forEach(function(e){it(e,n)}),a.forEach(function(e){fe(e,n)}),i.forEach(function(e){Gt(e,n)}),t.array(e.axes).forEach(function(e){Or(e,n)}),t.array(e.marks).forEach(function(e){yr(e,n)}),t.array(e.legends).forEach(function(e){br(e,n)}),e.title&&xr(e.title,n),n.parseLambdas(),n},Dr=t.toSet(["width","height","padding","autosize"]),$r=st.prototype=dt.prototype;$r.fork=function(){return new dt(this)},$r.toRuntime=function(){return this.finish(),{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig}},$r.id=function(){return(this._subid?this._subid+":":0)+this._id++},$r.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(function(t){t.$ref=e.id}),e.refs=null),e},$r.proxy=function(e){var t=e instanceof J?Z(e):e;return this.add(yn({value:t}))},$r.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},$r.addUpdate=function(e){return this.updates.push(e),e},$r.finish=function(){function e(e,t,n){var r;e&&((r=e.data||(e.data={}))[t]||(r[t]=[])).push(n)}var t,n;this.root&&(this.root.root=!0);for(t in this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;for(t in this.data){e((n=this.data[t]).input,t,"input"),e(n.output,t,"output"),e(n.values,t,"values");for(var r in n.index)e(n.index[r],t,"index:"+r)}return this},$r.pushState=function(e,t,n){this._encode.push(Z(this.add(Sn({pulse:e})))),this._parent.push(t),this._lookup.push(n?Z(this.proxy(n)):null),this._markpath.push(-1)},$r.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},$r.parent=function(){return t.peek(this._parent)},$r.encode=function(){return t.peek(this._encode)},$r.lookup=function(){return t.peek(this._lookup)},$r.markpath=function(){var e=this._markpath;return++e[e.length-1]},$r.fieldRef=function(e,n){if(t.isString(e))return ee(e,n);e.signal||t.error("Unsupported field reference: "+t.stringValue(e));var r,i=e.signal,a=this.field[i];return a||(r={name:this.signalRef(i)},n&&(r.as=n),this.field[i]=a=Z(this.add(un(r)))),a},$r.compareRef=function(e){function n(e){return ae(e)?(i=!0,Z(r[e.signal])):e}var r=this.signals,i=!1,a=t.array(e.field).map(n),o=t.array(e.order).map(n);return i?Z(this.add(rn({fields:a,orders:o}))):te(a,o)},$r.keyRef=function(e){var n=this.signals,r=!1;return e=t.array(e).map(function(e){return ae(e)?(r=!0,Z(n[e.signal])):e}),r?Z(this.add(sn({fields:e}))):ne(e)},$r.sortRef=function(e){if(!e)return e;var t=[ie(e.op,e.field),Jt],n=e.order||"ascending";return n.signal?Z(this.add(rn({fields:t,orders:[n=this.signalRef(n.signal),n]}))):te(t,[n,n])},$r.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},$r.addSignal=function(e,n){this.signals.hasOwnProperty(e)&&t.error("Duplicate signal name: "+t.stringValue(e));var r=n instanceof J?n:this.add(Q(n));return this.signals[e]=r},$r.getSignal=function(e){return this.signals[e]||t.error("Unrecognized signal name: "+t.stringValue(e)),this.signals[e]},$r.signalRef=function(e){return this.signals[e]?Z(this.signals[e]):(this.lambdas.hasOwnProperty(e)||(this.lambdas[e]=this.add(Q(null))),Z(this.lambdas[e]))},$r.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var r=e[t],i=Ut(r,this),a=this.lambdas[r];a.params=i.$params,a.update=i.$expr}},$r.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},$r.objectProperty=function(e){return e&&t.isObject(e)?this.signalRef(e.signal||ft(e)):e},$r.addBinding=function(e,n){this.bindings||t.error("Nested signals do not support binding: "+t.stringValue(e)),this.bindings.push(t.extend({signal:e},n))},$r.addScaleProj=function(e,n){this.scales.hasOwnProperty(e)&&t.error("Duplicate scale or projection name: "+t.stringValue(e)),this.scales[e]=this.add(n)},$r.addScale=function(e,t){this.addScaleProj(e,kn(t))},$r.addProjection=function(e,t){this.addScaleProj(e,vn(t))},$r.getScale=function(e){return this.scales[e]||t.error("Unrecognized scale name: "+t.stringValue(e)),this.scales[e]},$r.projectionRef=$r.scaleRef=function(e){return Z(this.getScale(e))},$r.projectionType=$r.scaleType=function(e){return this.getScale(e).params.type},$r.addData=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.data[e]=n},$r.getData=function(e){return this.data[e]||t.error("Undefined data set name: "+t.stringValue(e)),this.data[e]},$r.addDataPipeline=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.addData(e,Je.fromEntries(this,n))};var Er=function(e){var n=gt();return(e||[]).forEach(function(e){var r;if(e)for(r in e)n[r]=t.isObject(n[r])?t.extend(n[r],e[r]):n[r]=e[r]}),n},_r="sans-serif",Vr=30,Mr=2,Ar="#4c78a8",Fr="#000",Wr="#888",Cr="#ddd";e.parse=function(e,n){return t.isObject(e)||t.error("Input Vega specification must be an object."),ut(e,new st(Er([n,e.config]))).toRuntime()},e.signal=yt,e.signalUpdates=Gt,e.stream=Xt,e.codeGenerator=Bt,e.functionContext=Ft,e.expressionFunction=B,e.MarkRole=Kn,e.FrameRole=Qn,e.ScopeRole="scope",e.AxisRole="axis",e.AxisDomainRole="axis-domain",e.AxisGridRole="axis-grid",e.AxisLabelRole="axis-label",e.AxisTickRole="axis-tick",e.AxisTitleRole="axis-title",e.LegendRole="legend",e.LegendEntryRole="legend-entry",e.LegendLabelRole="legend-label",e.LegendSymbolRole="legend-symbol",e.LegendTitleRole="legend-title",e.Scope=st,e.DataScope=Je,e.formatLocale=o.formatDefaultLocale,e.timeFormatLocale=l.timeFormatDefaultLocale,Object.defineProperty(e,"__esModule",{value:!0})});